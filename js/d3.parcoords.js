d3.parcoords=function(a){function r(a,b,d){d3.keys(b).forEach(function(e){a[e]=function(f){if(!arguments.length)return b[e];"dimensions"===e&&"[object Array]"===Object.prototype.toString.call(f)&&(console.warn("pc.dimensions([]) is deprecated, use pc.dimensions({})"),f=c.applyDimensionDefaults(f));var g=b[e];return b[e]=f,q[e].call(c,{value:f,previous:g}),d[e].call(c,{value:f,previous:g}),a}})}function s(a,b){for(var c in b)a[c]=b[c];return a}function t(a,b){return b.forEach(function(b){delete a[b]}),a}function u(){return"bottom"==b.nullValueSeparator?[f()+1-b.nullValueSeparatorPadding.bottom-b.nullValueSeparatorPadding.top,1]:"top"==b.nullValueSeparator?[f()+1,1+b.nullValueSeparatorPadding.bottom+b.nullValueSeparatorPadding.top]:[f()+1,1]}function v(){if(b.brushed&&b.brushed.length!==b.data.length)return!0;var a=M.currentMode().brushState();for(var c in a)if(a.hasOwnProperty(c))return!0;return!1}function y(a){var c=d3.map(),d=d3.map();return b.data.forEach(function(c){var e=b.dimensions[a].yscale(c[a]);d.has(e)||d.set(e,0);var f=d.get(e);d.set(e,f+1)}),b.data.forEach(function(e){d3.keys(b.dimensions).map(function(f,g){var h=b.dimensions[a].yscale(e[a]);if(!c.has(h)){var i=d3.map();c.set(h,i)}c.get(h).has(f)||c.get(h).set(f,0);var j=c.get(h).get(f);j+=b.dimensions[f].yscale(e[f])/d.get(h),c.get(h).set(f,j)})}),c}function z(a){for(var c=[],d=d3.keys(b.dimensions),e=d.length,f=.5,g=0;g<e;++g){var h=P(d[g]),i=b.dimensions[d[g]].yscale(a[d[g]]);if(c.push($V([h,i])),g<e-1){var j=h+f*(P(d[g+1])-h),k=i+f*(b.dimensions[d[g+1]].yscale(a[d[g+1]])-i);if(null!==b.bundleDimension){var l=b.clusterCentroids.get(b.dimensions[b.bundleDimension].yscale(a[b.bundleDimension])).get(d[g]),m=b.clusterCentroids.get(b.dimensions[b.bundleDimension].yscale(a[b.bundleDimension])).get(d[g+1]),n=.5*(l+m);k=n+(1-b.bundlingStrength)*(k-n)}c.push($V([j,k]))}}return c}function A(a){var c=a.length,d=b.smoothness,e=[];e.push(a[0]),e.push($V([a[0].e(1)+2*d*(a[1].e(1)-a[0].e(1)),a[0].e(2)]));for(var f=1;f<c-1;++f){var g=a[f],h=a[f-1],i=a[f+1],j=h.subtract(i);e.push(g.add(j.x(d))),e.push(g),e.push(g.subtract(j.x(d)))}return e.push($V([a[c-1].e(1)+2*d*(a[c-2].e(1)-a[c-1].e(1)),a[c-1].e(2)])),e.push(a[c-1]),e}function B(a,c){var d=z(a),e=A(d);c.moveTo(e[0].e(1),e[0].e(2));for(var f=1;f<e.length;f+=3){if(b.showControlPoints)for(var g=0;g<3;g++)c.fillRect(e[f+g].e(1),e[f+g].e(2),2,2);c.bezierCurveTo(e[f].e(1),e[f].e(2),e[f+1].e(1),e[f+1].e(2),e[f+2].e(1),e[f+2].e(2))}}function C(a,c){c.beginPath(),null!==b.bundleDimension&&b.bundlingStrength>0||b.smoothness>0?B(a,c):F(a,c),c.stroke()}function E(){return"bottom"==b.nullValueSeparator?f()+1:"top"==b.nullValueSeparator?1:(console.log("A value is NULL, but nullValueSeparator is not set; set it to 'bottom' or 'top'."),f()+1)}function F(a,c){d3.entries(b.dimensions).forEach(function(d,e){0==e?c.moveTo(P(d.key),"undefined"==typeof a[d.key]?E():b.dimensions[d.key].yscale(a[d.key])):c.lineTo(P(d.key),"undefined"==typeof a[d.key]?E():b.dimensions[d.key].yscale(a[d.key]))})}function G(a,c){return null!==b.brushedColor?n.brushed.strokeStyle=d3.functor(b.brushedColor)(a,c):n.brushed.strokeStyle=d3.functor(b.color)(a,c),C(a,n.brushed)}function H(a,c){return n.foreground.strokeStyle=d3.functor(b.color)(a,c),C(a,n.foreground)}function I(a,c){return n.highlight.strokeStyle=d3.functor(b.color)(a,c),C(a,n.highlight)}function J(a){c.svg.selectAll(".dimension");c.flip(a),d3.select(this.parentElement).transition().duration(b.animationTime).call(l.scale(b.dimensions[a].yscale)).call(l.orient(b.dimensions[a].orient)).call(l.ticks(b.dimensions[a].ticks)).call(l.innerTickSize(b.dimensions[a].innerTickSize)).call(l.outerTickSize(b.dimensions[a].outerTickSize)).call(l.tickPadding(b.dimensions[a].tickPadding)).call(l.tickFormat(b.dimensions[a].tickFormat)),c.render()}function K(){if(b.rotateLabels){var a=d3.event.deltaY;a=a<0?-5:a,a=a>0?5:a,b.dimensionTitleRotation+=a,c.svg.selectAll("text.label").attr("transform","translate(0,-5) rotate("+b.dimensionTitleRotation+")"),d3.event.preventDefault()}}function L(a){return b.dimensions[a].title?b.dimensions[a].title:a}function N(a){b.brushed=a,d.brush.call(c,b.brushed),c.renderBrushed()}function O(a){if(!arguments.length)return M.predicate;if(a=String(a).toUpperCase(),"AND"!==a&&"OR"!==a)throw"Invalid predicate "+a;return M.predicate=a,b.brushed=M.currentMode().selected(),c.renderBrushed(),c}function P(a){0===h.range().length&&h.rangePoints([0,e()],1);var b=i[a];return null==b?h(a):b}var b={data:[],highlighted:[],dimensions:{},dimensionTitleRotation:0,brushed:!1,brushedColor: "#32CD32",alphaOnBrushed:0,mode:"default",rate:20,width:600,height:300,margin:{top:24,right:0,bottom:12,left:0},nullValueSeparator:"undefined",nullValueSeparatorPadding:{top:8,right:0,bottom:8,left:0},color:"#069",composite:"source-over",alpha:.7,bundlingStrength:.5,bundleDimension:null,smoothness:0,showControlPoints:!1,hideAxis:[],flipAxes:[],animationTime:1100,rotateLabels:!1};s(b,a),a&&a.dimensionTitles&&(console.warn("dimensionTitles passed in config is deprecated. Add title to dimension object."),d3.entries(a.dimensionTitles).forEach(function(a){b.dimensions[a.key]?b.dimensions[a.key].title=b.dimensions[a.key].title?b.dimensions[a.key].title:a.value:b.dimensions[a.key]={title:a.value}}));var m,c=function(a){return a=c.selection=d3.select(a),b.width=a[0][0].clientWidth,b.height=a[0][0].clientHeight,["marks","foreground","brushed","highlight"].forEach(function(b){o[b]=a.append("canvas").attr("class",b)[0][0],n[b]=o[b].getContext("2d")}),c.svg=a.append("svg").attr("width",b.width).attr("height",b.height).style("font","14px sans-serif").style("position","absolute").append("svg:g").attr("transform","translate("+b.margin.left+","+b.margin.top+")"),c},d=d3.dispatch.apply(this,["render","resize","highlight","brush","brushend","brushstart","axesreorder"].concat(d3.keys(b))),e=function(){return b.width-b.margin.right-b.margin.left},f=function(){return b.height-b.margin.top-b.margin.bottom},g={brushable:!1,reorderable:!1,axes:!1,interactive:!1,debug:!1},h=d3.scale.ordinal(),i={},l=(d3.svg.line(),d3.svg.axis().orient("left").ticks(5)),n={},o={},q=d3.dispatch.apply(this,d3.keys(b)).on("composite",function(a){n.foreground.globalCompositeOperation=a.value,n.brushed.globalCompositeOperation=a.value}).on("alpha",function(a){n.foreground.globalAlpha=a.value,n.brushed.globalAlpha=a.value}).on("brushedColor",function(a){n.brushed.strokeStyle=a.value}).on("width",function(a){c.resize()}).on("height",function(a){c.resize()}).on("margin",function(a){c.resize()}).on("rate",function(a){x.rate(a.value),w.rate(a.value)}).on("dimensions",function(a){b.dimensions=c.applyDimensionDefaults(d3.keys(a.value)),h.domain(c.getOrderedDimensionKeys()),c.sortDimensions(),g.interactive&&c.render().updateAxes()}).on("bundleDimension",function(a){d3.keys(b.dimensions).length||c.detectDimensions(),c.autoscale(),"number"==typeof a.value?a.value<d3.keys(b.dimensions).length?b.bundleDimension=b.dimensions[a.value]:a.value<b.hideAxis.length&&(b.bundleDimension=b.hideAxis[a.value]):b.bundleDimension=a.value,b.clusterCentroids=y(b.bundleDimension),g.interactive&&c.render()}).on("hideAxis",function(a){c.dimensions(c.applyDimensionDefaults()),c.dimensions(t(b.dimensions,a.value))}).on("flipAxes",function(a){a.value&&a.value.length&&(a.value.forEach(function(a){J(a)}),c.updateAxes(0))});c.state=b,c.flags=g,r(c,b,d),d3.rebind(c,d,"on"),c.autoscale=function(){var a={date:function(a){var c=d3.extent(b.data,function(b){return b[a]?b[a].getTime():null});return c[0]===c[1]?d3.scale.ordinal().domain([c[0]]).rangePoints(u()):d3.time.scale().domain(c).range(u())},number:function(a){var c=d3.extent(b.data,function(b){return+b[a]});return c[0]===c[1]?d3.scale.ordinal().domain([c[0]]).rangePoints(u()):d3.scale.linear().domain(c).range(u())},string:function(a){var c={},d=[];return b.data.map(function(d){void 0===d[a]&&"undefined"!==b.nullValueSeparator||(void 0===c[d[a]]?c[d[a]]=1:c[d[a]]=c[d[a]]+1)}),d=Object.getOwnPropertyNames(c).sort(function(a,b){return c[a]-c[b]}),d3.scale.ordinal().domain(d).rangePoints(u())}};d3.keys(b.dimensions).forEach(function(c){b.dimensions[c].yscale||(b.dimensions[c].yscale=a[b.dimensions[c].type](c))}),h.rangePoints([0,e()],1);var d=window.devicePixelRatio||1;return c.selection.selectAll("canvas").style("margin-top",b.margin.top+"px").style("margin-left",b.margin.left+"px").style("width",e()+2+"px").style("height",f()+2+"px").attr("width",(e()+2)*d).attr("height",(f()+2)*d),n.foreground.strokeStyle=b.color,n.foreground.lineWidth=1.4,n.foreground.globalCompositeOperation=b.composite,n.foreground.globalAlpha=b.alpha,n.foreground.scale(d,d),n.brushed.strokeStyle=b.brushedColor,n.brushed.lineWidth=1.4,n.brushed.globalCompositeOperation=b.composite,n.brushed.globalAlpha=b.alpha,n.brushed.scale(d,d),n.highlight.lineWidth=3,n.highlight.scale(d,d),this},c.scale=function(a,c){return b.dimensions[a].yscale.domain(c),this},c.flip=function(a){return b.dimensions[a].yscale.domain(b.dimensions[a].yscale.domain().reverse()),this},c.commonScale=function(a,d){var e=d||"number";"undefined"==typeof a&&(a=!0),d3.keys(b.dimensions).length||c.detectDimensions(),c.autoscale();var f=d3.keys(b.dimensions).filter(function(a){return b.dimensions[a].type==e});if(a){var g=d3.extent(f.map(function(a,c){return b.dimensions[a].yscale.domain()}).reduce(function(a,b){return a.concat(b)}));f.forEach(function(a){b.dimensions[a].yscale.domain(g)})}else f.forEach(function(a){b.dimensions[a].yscale.domain(d3.extent(b.data,function(a){return+a[k]}))});return null!==b.bundleDimension&&c.bundleDimension(b.bundleDimension),this},c.detectDimensions=function(){return c.dimensions(c.applyDimensionDefaults()),this},c.applyDimensionDefaults=function(a){var d=c.detectDimensionTypes(b.data);a=a?a:d3.keys(d);var e={},f=0;return a.forEach(function(a){e[a]=b.dimensions[a]?b.dimensions[a]:{},e[a].orient=e[a].orient?e[a].orient:"left",e[a].ticks=null!=e[a].ticks?e[a].ticks:5,e[a].innerTickSize=null!=e[a].innerTickSize?e[a].innerTickSize:6,e[a].outerTickSize=null!=e[a].outerTickSize?e[a].outerTickSize:0,e[a].tickPadding=null!=e[a].tickPadding?e[a].tickPadding:3,e[a].type=e[a].type?e[a].type:d[a],e[a].index=null!=e[a].index?e[a].index:f,f++}),e},c.getOrderedDimensionKeys=function(){return d3.keys(b.dimensions).sort(function(a,c){return d3.ascending(b.dimensions[a].index,b.dimensions[c].index)})},c.toType=function(a){return{}.toString.call(a).match(/\s([a-zA-Z]+)/)[1].toLowerCase()},c.toTypeCoerceNumbers=function(a){return parseFloat(a)==a&&null!=a?"number":c.toType(a)},c.detectDimensionTypes=function(a){var b={};return d3.keys(a[0]).forEach(function(d){b[isNaN(Number(d))?d:parseInt(d)]=c.toTypeCoerceNumbers(a[0][d])}),b},c.render=function(){return d3.keys(b.dimensions).length||c.detectDimensions(),c.autoscale(),c.render[b.mode](),d.render.call(this),this},c.renderBrushed=function(){return d3.keys(b.dimensions).length||c.detectDimensions(),c.renderBrushed[b.mode](),d.render.call(this),this},c.render.default=function(){c.clear("foreground"),c.clear("highlight"),c.renderBrushed.default(),b.data.forEach(H)};var w=d3.renderQueue(H).rate(50).clear(function(){c.clear("foreground"),c.clear("highlight")});c.render.queue=function(){c.renderBrushed.queue(),w(b.data)},c.renderBrushed.default=function(){c.clear("brushed"),v()&&b.brushed.forEach(G)};var x=d3.renderQueue(G).rate(50).clear(function(){c.clear("brushed")});c.renderBrushed.queue=function(){x(v()?b.brushed:[])},c.compute_real_centroids=function(a){for(var c=[],d=d3.keys(b.dimensions),e=d.length,g=0;g<e;++g){var h=P(d[g]),i=b.dimensions[d[g]].yscale(a[d[g]]);c.push([h,i])}return c},c.shadows=function(){return g.shadows=!0,c.alphaOnBrushed(.1),c.render(),this},c.axisDots=function(a){var a=a||.1,d=c.ctx.marks,e=0,f=2*Math.PI;return d.globalAlpha=d3.min([1/Math.pow(b.data.length,.5),1]),b.data.forEach(function(c){d3.entries(b.dimensions).forEach(function(g,h){d.beginPath(),d.arc(P(g),b.dimensions[g.key].yscale(c[g]),a,e,f),d.stroke(),d.fill()})}),this},c.clear=function(a){return n[a].clearRect(0,0,e()+2,f()+2),"brushed"===a&&v()&&(n.brushed.fillStyle=c.selection.style("background-color"),n.brushed.globalAlpha=1-b.alphaOnBrushed,n.brushed.fillRect(0,0,e()+2,f()+2),n.brushed.globalAlpha=b.alpha),this},d3.rebind(c,l,"ticks","orient","tickValues","tickSubdivide","tickSize","tickPadding","tickFormat"),c.createAxes=function(){return m&&c.removeAxes(),m=c.svg.selectAll(".dimension").data(c.getOrderedDimensionKeys(),function(a){return a}).enter().append("svg:g").attr("class","dimension").attr("transform",function(a){return"translate("+h(a)+")"}),m.append("svg:g").attr("class","axis").attr("transform","translate(0,0)").each(function(a){var d=d3.select(this).call(c.applyAxisConfig(l,b.dimensions[a]));d.selectAll("path").style("fill","none").style("stroke","#222").style("shape-rendering","crispEdges"),d.selectAll("line").style("fill","none").style("stroke","#222").style("shape-rendering","crispEdges")}).append("svg:text").attr({"text-anchor":"middle",y:0,transform:"translate(0,-5) rotate("+b.dimensionTitleRotation+")",x:0,class:"label",fill:"green"}).text(L).on("dblclick",J).on("wheel",K),"top"==b.nullValueSeparator?c.svg.append("line").attr("x1",0).attr("y1",1+b.nullValueSeparatorPadding.top).attr("x2",e()).attr("y2",1+b.nullValueSeparatorPadding.top).attr("stroke-width",1).attr("stroke","#777").attr("fill","none").attr("shape-rendering","crispEdges"):"bottom"==b.nullValueSeparator&&c.svg.append("line").attr("x1",0).attr("y1",f()+1-b.nullValueSeparatorPadding.bottom).attr("x2",e()).attr("y2",f()+1-b.nullValueSeparatorPadding.bottom).attr("stroke-width",1).attr("stroke","#777").attr("fill","none").attr("shape-rendering","crispEdges"),g.axes=!0,this},c.removeAxes=function(){return m.remove(),m=void 0,this},c.updateAxes=function(a){"undefined"==typeof a&&(a=b.animationTime);var d=c.svg.selectAll(".dimension").data(c.getOrderedDimensionKeys());if(d.enter().append("svg:g").attr("class","dimension").attr("transform",function(a){return"translate("+P(a)+")"}).style("opacity",0).append("svg:g").attr("class","axis").attr("transform","translate(0,0)").each(function(a){var d=d3.select(this).call(c.applyAxisConfig(l,b.dimensions[a]));d.selectAll("path").style("fill","none").style("stroke","#222").style("shape-rendering","crispEdges"),d.selectAll("line").style("fill","none").style("stroke","#222").style("shape-rendering","crispEdges")}).append("svg:text").attr({"text-anchor":"middle",y:0,transform:"translate(0,-5) rotate("+b.dimensionTitleRotation+")",x:0,class:"label"}).text(L).on("dblclick",J).on("wheel",K),d.attr("opacity",0),d.select(".axis").transition().duration(a).each(function(a){d3.select(this).call(c.applyAxisConfig(l,b.dimensions[a]))}),d.select(".label").transition().duration(a).text(L).attr("transform","translate(0,-5) rotate("+b.dimensionTitleRotation+")"),d.exit().remove(),m=c.svg.selectAll(".dimension"),m.transition().duration(a).attr("transform",function(a){return"translate("+P(a)+")"}).style("opacity",1),c.svg.selectAll(".axis").transition().duration(a).each(function(a){d3.select(this).call(c.applyAxisConfig(l,b.dimensions[a]))}),g.brushable&&c.brushable(),g.reorderable&&c.reorderable(),"None"!==c.brushMode()){var e=c.brushMode();c.brushMode("None"),c.brushMode(e)}return this},c.applyAxisConfig=function(a,b){return a.scale(b.yscale).orient(b.orient).ticks(b.ticks).tickValues(b.tickValues).innerTickSize(b.innerTickSize).outerTickSize(b.outerTickSize).tickPadding(b.tickPadding).tickFormat(b.tickFormat)},c.reorderable=function(){return m||c.createAxes(),m.style("cursor","move").call(d3.behavior.drag().on("dragstart",function(a){i[a]=this.__origin__=h(a)}).on("drag",function(a){i[a]=Math.min(e(),Math.max(0,this.__origin__+=d3.event.dx)),c.sortDimensions(),h.domain(c.getOrderedDimensionKeys()),c.render(),m.attr("transform",function(a){return"translate("+P(a)+")"})}).on("dragend",function(a){for(var e=0,f=b.dimensions[a].index,g=this,j=this.parentElement;null!=(g=g.previousElementSibling);)++e;e!==f&&(d.axesreorder.call(c,c.getOrderedDimensionKeys()),e>f?j.insertBefore(this,j.children[f-1]):f+1<j.children.length?j.insertBefore(this,j.children[f+1]):j.appendChild(this)),delete this.__origin__,delete i[a],d3.select(this).transition().attr("transform","translate("+h(a)+")"),c.render()})),g.reorderable=!0,this},c.reorder=function(a){var d=c.getOrderedDimensionKeys()[0];c.sortDimensionsByRowData(a);var e=!1;if(e=d!==c.getOrderedDimensionKeys()[0]){h.domain(c.getOrderedDimensionKeys());var f=b.highlighted.slice(0);c.unhighlight(),m.transition().duration(1500).attr("transform",function(a){return"translate("+h(a)+")"}),c.render(),0!==f.length&&c.highlight(f)}},c.sortDimensionsByRowData=function(a){var c=b.dimensions,d=d3.keys(b.dimensions).sort(function(c,d){var e=b.dimensions[c].yscale(a[c])-b.dimensions[d].yscale(a[d]);return 0===e?c.localeCompare(d):e});b.dimensions={},d.forEach(function(a,d){b.dimensions[a]=c[a],b.dimensions[a].index=d})},c.sortDimensions=function(){var a=b.dimensions,c=d3.keys(b.dimensions).sort(function(a,b){return P(a)-P(b)});b.dimensions={},c.forEach(function(c,d){b.dimensions[c]=a[c],b.dimensions[c].index=d})},c.adjacent_pairs=function(a){for(var b=[],c=0;c<a.length-1;c++)b.push([a[c],a[c+1]]);return b};var M={modes:{None:{install:function(a){},uninstall:function(a){},selected:function(){return[]},brushState:function(){return{}}}},mode:"None",predicate:"AND",currentMode:function(){return this.modes[this.mode]}};return c.brushModes=function(){return Object.getOwnPropertyNames(M.modes)},c.brushMode=function(a){if(0===arguments.length)return M.mode;if(c.brushModes().indexOf(a)===-1)throw"pc.brushmode: Unsupported brush mode: "+a;return a!==M.mode&&("None"!==M.mode&&c.brushReset(),M.modes[M.mode].uninstall(c),M.mode=a,M.modes[M.mode].install(),"None"===a?delete c.brushPredicate:c.brushPredicate=O),c},function(){function e(b){return!a[b].empty()}function f(){var c=d3.keys(b.dimensions).filter(e),d=c.map(function(b){return a[b].extent()});if(0===c.length)return b.data;var f={date:function(a,c,e){return"function"==typeof b.dimensions[c].yscale.rangePoints?d[e][0]<=b.dimensions[c].yscale(a[c])&&b.dimensions[c].yscale(a[c])<=d[e][1]:d[e][0]<=a[c]&&a[c]<=d[e][1]},number:function(a,c,e){return"function"==typeof b.dimensions[c].yscale.rangePoints?d[e][0]<=b.dimensions[c].yscale(a[c])&&b.dimensions[c].yscale(a[c])<=d[e][1]:d[e][0]<=a[c]&&a[c]<=d[e][1]},string:function(a,c,e){return d[e][0]<=b.dimensions[c].yscale(a[c])&&b.dimensions[c].yscale(a[c])<=d[e][1]}};return b.data.filter(function(a){switch(M.predicate){case"AND":return c.every(function(c,d){return f[b.dimensions[c].type](a,c,d)});case"OR":return c.some(function(c,d){return f[b.dimensions[c].type](a,c,d)});default:throw"Unknown brush predicate "+b.brushPredicate}})}function g(d){if("undefined"==typeof d){var d={};return d3.keys(b.dimensions).forEach(function(b){var c=a[b];if(void 0!==c&&!c.empty()){var e=c.extent();e.sort(d3.ascending),d[b]=e}}),d}var e={};return m.selectAll(".brush").each(function(a){e[a]=d3.select(this)}),d3.keys(b.dimensions).forEach(function(b){if(void 0!==d[b]){var c=a[b];void 0!==c&&(c.extent(d[b]),e[b].transition().duration(0).call(c),c.event(e[b]))}}),c.renderBrushed(),c}function h(e){var g=d3.svg.brush();return g.y(b.dimensions[e].yscale).on("brushstart",function(){null!==d3.event.sourceEvent&&(d.brushstart.call(c,b.brushed),d3.event.sourceEvent.stopPropagation())}).on("brush",function(){N(f())}).on("brushend",function(){d.brushend.call(c,b.brushed)}),a[e]=g,g}function i(d){return void 0===d?(b.brushed=!1,m&&(m.selectAll(".brush").each(function(b){d3.select(this).transition().duration(0).call(a[b].clear())}),c.renderBrushed())):m&&(m.selectAll(".brush").each(function(b){b==d&&(d3.select(this).transition().duration(0).call(a[b].clear()),a[b].event(d3.select(this)))}),c.renderBrushed()),this}function j(){m||c.createAxes();var a=m.append("svg:g").attr("class","brush").each(function(a){d3.select(this).call(h(a))});return a.selectAll("rect").style("visibility",null).attr("x",-15).attr("width",30),a.selectAll("rect.background").style("fill","transparent"),a.selectAll("rect.extent").style("fill","rgba(255,255,255,0.25)").style("stroke","rgba(0,0,0,0.6)"),a.selectAll(".resize rect").style("fill","rgba(0,0,0,0.1)"),c.brushExtents=g,c.brushReset=i,c}var a={};M.modes["1D-axes"]={install:j,uninstall:function(){m.selectAll(".brush").remove(),a={},delete c.brushExtents,delete c.brushReset},selected:f,brushState:g}}(),function(){function i(a,b){var d=c.selection.select("svg").select("g#strums"),e=a.dims.i,f=[a.p1,a.p2],g=d.selectAll("line#strum-"+e).data([a]),h=d.selectAll("circle#strum-"+e).data(f),j=d3.behavior.drag();g.enter().append("line").attr("id","strum-"+e).attr("class","strum"),g.attr("x1",function(a){return a.p1[0]}).attr("y1",function(a){return a.p1[1]}).attr("x2",function(a){return a.p2[0]}).attr("y2",function(a){return a.p2[1]}).attr("stroke","black").attr("stroke-width",2),j.on("drag",function(b,c){var d=d3.event;c+=1,a["p"+c][0]=Math.min(Math.max(a.minX+1,d.x),a.maxX),a["p"+c][1]=Math.min(Math.max(a.minY,d.y),a.maxY),i(a,c-1)}).on("dragend",p()),h.enter().append("circle").attr("id","strum-"+e).attr("class","strum"),h.attr("cx",function(a){return a[0]}).attr("cy",function(a){return a[1]}).attr("r",5).style("opacity",function(a,c){return void 0!==b&&c===b?.8:0}).on("mouseover",function(){d3.select(this).style("opacity",.8)}).on("mouseout",function(){d3.select(this).style("opacity",0)}).call(j)}function j(a){var d={i:-1,left:void 0,right:void 0};return d3.keys(b.dimensions).some(function(e,f){if(h(e)<a[0]){var g=d3.keys(b.dimensions)[c.getOrderedDimensionKeys().indexOf(e)+1];return d.i=f,d.left=e,d.right=g,!1}return!0}),void 0===d.left?(d.i=0,d.left=c.getOrderedDimensionKeys()[0],d.right=c.getOrderedDimensionKeys()[1]):void 0===d.right&&(d.i=d3.keys(b.dimensions).length-1,d.right=d.left,d.left=c.getOrderedDimensionKeys()[d3.keys(b.dimensions).length-2]),d}function k(){return function(){var d,e,c=d3.mouse(g[0][0]);c[0]=c[0]-b.margin.left,c[1]=c[1]-b.margin.top,d=j(c),e={p1:c,dims:d,minX:h(d.left),maxX:h(d.right),minY:0,maxY:f()},a[d.i]=e,a.active=d.i,e.p1[0]=Math.min(Math.max(e.minX,c[0]),e.maxX),e.p2=e.p1.slice()}}function l(){return function(){var c=d3.event,d=a[a.active];d.p2[0]=Math.min(Math.max(d.minX+1,c.x-b.margin.left),d.maxX),d.p2[1]=Math.min(Math.max(d.minY,c.y-b.margin.top),d.maxY),i(d,1)}}function m(a,b){var c=[a.p1[0]-a.minX,a.p1[1]-a.minX],d=[a.p2[0]-a.minX,a.p2[1]-a.minX],e=1-b/c[0],f=c[1]*(1-e),g=1-b/d[0],h=d[1]*(1-g);return function(a){var b=a[0],c=a[1],d=e*b+f,i=g*b+h;return c>Math.min(d,i)&&c<Math.max(d,i)}}function n(){function e(c,d){var e=a[d],f=m(e,a.width(d)),g=e.dims.left,h=e.dims.right,i=b.dimensions[g].yscale,j=b.dimensions[h].yscale,k=[i(c[g])-e.minX,j(c[h])-e.minX];return f(k)}var c=Object.getOwnPropertyNames(a),d=b.data;return c=c.filter(function(a){return!isNaN(a)}),0===c.length?d:d.filter(function(a){switch(M.predicate){case"AND":return c.every(function(b){return e(a,b)});case"OR":return c.some(function(b){return e(a,b)});default:throw"Unknown brush predicate "+b.brushPredicate}})}function o(){var b=a[a.active],d=c.selection.select("svg").select("g#strums");delete a[a.active],a.active=void 0,d.selectAll("line#strum-"+b.dims.i).remove(),d.selectAll("circle#strum-"+b.dims.i).remove()}function p(){return function(){var e=b.data,f=a[a.active];f&&f.p1[0]===f.p2[0]&&f.p1[1]===f.p2[1]&&o(a),e=n(a),a.active=void 0,b.brushed=e,c.renderBrushed(),d.brushend.call(c,b.brushed)}}function q(a){return function(){var b=Object.getOwnPropertyNames(a).filter(function(a){return!isNaN(a)});b.forEach(function(b){a.active=b,o(a)}),p(a)()}}function r(){var d=d3.behavior.drag();a.active=void 0,a.width=function(b){var c=a[b];if(void 0!==c)return c.maxX-c.minX},c.on("axesreorder.strums",function(){function d(a,c){var d=d3.keys(b.dimensions).length;return d3.keys(b.dimensions).some(function(e,f){return e===a&&(f+f<d&&b.dimensions[f+1]===c)})}var c=Object.getOwnPropertyNames(a).filter(function(a){return!isNaN(a)});c.length>0&&(c.forEach(function(b){var c=a[b].dims;a.active=b,d(c.left,c.right)||o(a)}),p(a)())}),c.selection.select("svg").append("g").attr("id","strums").attr("transform","translate("+b.margin.left+","+b.margin.top+")"),c.brushReset=q(a),d.on("dragstart",k(a)).on("drag",l(a)).on("dragend",p(a)),g=c.selection.select("svg").insert("rect","g#strums").attr("id","strum-events").attr("x",b.margin.left).attr("y",b.margin.top).attr("width",e()).attr("height",f()+2).style("opacity",0).call(d)}var g,a={};M.modes["2D-strums"]={install:r,uninstall:function(){c.selection.select("svg").select("g#strums").remove(),c.selection.select("svg").select("rect#strum-events").remove(),c.on("axesreorder.strums",void 0),delete c.brushReset,g=void 0},selected:n,brushState:function(){return a}}}(),function(){function e(b){return!a[b].empty()}function f(){var c=d3.keys(b.dimensions).filter(e),d=c.map(function(b){return a[b].extent()});if(0===c.length)return b.data;var f={date:function(a,c,d,e){return"function"==typeof b.dimensions[c].yscale.rangePoints?e[0]<=b.dimensions[c].yscale(a[c])&&b.dimensions[c].yscale(a[c])<=e[1]:e[0]<=a[c]&&a[c]<=e[1]},number:function(a,c,d,e){return"function"==typeof b.dimensions[c].yscale.rangePoints?e[0]<=b.dimensions[c].yscale(a[c])&&b.dimensions[c].yscale(a[c])<=e[1]:e[0]<=a[c]&&a[c]<=e[1]},string:function(a,c,d,e){return e[0]<=b.dimensions[c].yscale(a[c])&&b.dimensions[c].yscale(a[c])<=e[1]}};return b.data.filter(function(a){switch(M.predicate){case"AND":return c.every(function(c,e){return d[e].some(function(d){return f[b.dimensions[c].type](a,c,e,d)})});case"OR":return c.some(function(c,e){return d[e].some(function(d){return f[b.dimensions[c].type](a,c,e,d)})});default:throw"Unknown brush predicate "+b.brushPredicate}})}function g(d){if("undefined"==typeof d)return d={},d3.keys(b.dimensions).forEach(function(b){var c=a[b];if(void 0!==c&&!c.empty()){var e=c.extent();d[b]=e}}),d;var e={};return m.selectAll(".brush").each(function(a){e[a]=d3.select(this)}),d3.keys(b.dimensions).forEach(function(b){if(void 0!==d[b]){var c=a[b];void 0!==c&&(c.extent(d[b]),e[b].transition().duration(0).call(c),c.event(e[b]))}}),c.renderBrushed(),c}function h(e){var g=d3.svg.multibrush();return g.y(b.dimensions[e].yscale).on("brushstart",function(){null!==d3.event.sourceEvent&&(d.brushstart.call(c,b.brushed),d3.event.sourceEvent.stopPropagation())}).on("brush",function(){N(f())}).on("brushend",function(){N(f()),d.brushend.call(c,b.brushed)}).extentAdaption(function(a){a.style("visibility",null).attr("x",-15).attr("width",30).style("fill","rgba(255,255,255,0.25)").style("stroke","rgba(0,0,0,0.6)")}).resizeAdaption(function(a){a.selectAll("rect").attr("x",-15).attr("width",30).style("visibility",null).style("fill","rgba(0,0,0,0.1)")}),a[e]=g,g}function i(d){return b.brushed=!1,m&&(m.selectAll(".brush").each(function(b){d3.select(this).call(a[b].clear())}),c.renderBrushed()),this}function j(){m||c.createAxes();var a=m.append("svg:g").attr("class","brush").each(function(a){d3.select(this).call(h(a))});return a.selectAll("rect").style("visibility",null).attr("x",-15).attr("width",30),a.selectAll("rect.background").style("fill","transparent"),a.selectAll("rect.extent").style("fill","rgba(255,255,255,0.25)").style("stroke","rgba(0,0,0,0.6)"),a.selectAll(".resize rect").style("fill","rgba(0,0,0,0.1)"),c.brushExtents=g,c.brushReset=i,c}if("function"==typeof d3.svg.multibrush){var a={};M.modes["1D-axes-multi"]={install:j,uninstall:function(){m.selectAll(".brush").remove(),a={},delete c.brushExtents,delete c.brushReset},selected:f,brushState:g}}}(),function(){function i(b,d){var e=c.selection.select("svg").select("g#arcs"),f=b.dims.i,g=[b.p2,b.p3],h=e.selectAll("line#arc-"+f).data([{p1:b.p1,p2:b.p2},{p1:b.p1,p2:b.p3}]),j=e.selectAll("circle#arc-"+f).data(g),k=d3.behavior.drag(),l=e.selectAll("path#arc-"+f).data([b]);l.enter().append("path").attr("id","arc-"+f).attr("class","arc").style("fill","orange").style("opacity",.5),l.attr("d",b.arc).attr("transform","translate("+b.p1[0]+","+b.p1[1]+")"),h.enter().append("line").attr("id","arc-"+f).attr("class","arc"),h.attr("x1",function(a){return a.p1[0]}).attr("y1",function(a){return a.p1[1]}).attr("x2",function(a){return a.p2[0]}).attr("y2",function(a){return a.p2[1]}).attr("stroke","black").attr("stroke-width",2),k.on("drag",function(c,d){var e=d3.event,g=0;d+=2,b["p"+d][0]=Math.min(Math.max(b.minX+1,e.x),b.maxX),b["p"+d][1]=Math.min(Math.max(b.minY,e.y),b.maxY),g=3===d?a.startAngle(f):a.endAngle(f),(b.startAngle<Math.PI&&b.endAngle<Math.PI&&g<Math.PI||b.startAngle>=Math.PI&&b.endAngle>=Math.PI&&g>=Math.PI)&&(2===d?(b.endAngle=g,b.arc.endAngle(g)):3===d&&(b.startAngle=g,b.arc.startAngle(g))),i(b,d-2)}).on("dragend",t()),j.enter().append("circle").attr("id","arc-"+f).attr("class","arc"),j.attr("cx",function(a){return a[0]}).attr("cy",function(a){return a[1]}).attr("r",5).style("opacity",function(a,b){return void 0!==d&&b===d?.8:0}).on("mouseover",function(){d3.select(this).style("opacity",.8)}).on("mouseout",function(){d3.select(this).style("opacity",0)}).call(k)}function j(a){var d={i:-1,left:void 0,right:void 0};return d3.keys(b.dimensions).some(function(e,f){if(h(e)<a[0]){var g=d3.keys(b.dimensions)[c.getOrderedDimensionKeys().indexOf(e)+1];return d.i=f,d.left=e,d.right=g,!1}return!0}),void 0===d.left?(d.i=0,d.left=c.getOrderedDimensionKeys()[0],d.right=c.getOrderedDimensionKeys()[1]):void 0===d.right&&(d.i=d3.keys(b.dimensions).length-1,d.right=d.left,d.left=c.getOrderedDimensionKeys()[d3.keys(b.dimensions).length-2]),d}function k(){return function(){var d,e,c=d3.mouse(g[0][0]);c[0]=c[0]-b.margin.left,c[1]=c[1]-b.margin.top,d=j(c),e={p1:c,dims:d,minX:h(d.left),maxX:h(d.right),minY:0,maxY:f(),startAngle:void 0,endAngle:void 0,arc:d3.svg.arc().innerRadius(0)},a[d.i]=e,a.active=d.i,e.p1[0]=Math.min(Math.max(e.minX,c[0]),e.maxX),e.p2=e.p1.slice(),e.p3=e.p1.slice()}}function l(){return function(){var c=d3.event,d=a[a.active];d.p2[0]=Math.min(Math.max(d.minX+1,c.x-b.margin.left),d.maxX),d.p2[1]=Math.min(Math.max(d.minY,c.y-b.margin.top),d.maxY),d.p3=d.p2.slice(),i(d,1)}}function m(a,b){return Math.sqrt(a*a+b*b)}function q(a){var b=p(a.startAngle),c=p(a.endAngle);if(b>c){var d=b;b=c,c=d}return function(a){return a>=b&&a<=c}}function r(){function e(c,d){var e=a[d],f=q(e),g=e.dims.left,h=e.dims.right,i=b.dimensions[g].yscale,j=b.dimensions[h].yscale,k=a.width(d),l=i(c[g])-j(c[h]),n=m(k,l),o=Math.asin(l/n);return f(o)}var c=Object.getOwnPropertyNames(a),d=b.data;return c=c.filter(function(a){return!isNaN(a)}),0===c.length?d:d.filter(function(a){switch(M.predicate){case"AND":return c.every(function(b){return e(a,b)});case"OR":return c.some(function(b){return e(a,b)});default:throw"Unknown brush predicate "+b.brushPredicate}})}function s(){var b=a[a.active],d=c.selection.select("svg").select("g#arcs");delete a[a.active],a.active=void 0,d.selectAll("line#arc-"+b.dims.i).remove(),d.selectAll("circle#arc-"+b.dims.i).remove(),d.selectAll("path#arc-"+b.dims.i).remove()}function t(){return function(){var e=b.data,f=a[a.active];if(f&&f.p1[0]===f.p2[0]&&f.p1[1]===f.p2[1]&&s(a),f){var g=a.startAngle(a.active);f.startAngle=g,f.endAngle=g,f.arc.outerRadius(a.length(a.active)).startAngle(g).endAngle(g)}e=r(a),a.active=void 0,b.brushed=e,c.renderBrushed(),d.brushend.call(c,b.brushed)}}function u(a){return function(){var b=Object.getOwnPropertyNames(a).filter(function(a){return!isNaN(a)});b.forEach(function(b){a.active=b,s(a)}),t(a)()}}function v(){var d=d3.behavior.drag();a.active=void 0,a.width=function(b){var c=a[b];if(void 0!==c)return c.maxX-c.minX},angle=function(a,b){var c=a[0]-b[0],d=a[1]-b[1],e=m(c,d);return Math.asin(d/e)},a.endAngle=function(b){var c=a[b];if(void 0!==c){var d=angle(c.p1,c.p2),e=-d+Math.PI/2;return c.p1[0]>c.p2[0]&&(e=2*Math.PI-e),e}},a.startAngle=function(b){var c=a[b];if(void 0!==c){var d=angle(c.p1,c.p3),e=-d+Math.PI/2;
return c.p1[0]>c.p3[0]&&(e=2*Math.PI-e),e}},a.length=function(b){var c=a[b];if(void 0!==c){var d=c.p1[0]-c.p2[0],e=c.p1[1]-c.p2[1],f=m(d,e);return f}},c.on("axesreorder.arcs",function(){function d(a,c){var d=d3.keys(b.dimensions).length;return d3.keys(b.dimensions).some(function(e,f){return e===a&&(f+f<d&&b.dimensions[f+1]===c)})}var c=Object.getOwnPropertyNames(a).filter(function(a){return!isNaN(a)});c.length>0&&(c.forEach(function(b){var c=a[b].dims;a.active=b,d(c.left,c.right)||s(a)}),t(a)())}),c.selection.select("svg").append("g").attr("id","arcs").attr("transform","translate("+b.margin.left+","+b.margin.top+")"),c.brushReset=u(a),d.on("dragstart",k(a)).on("drag",l(a)).on("dragend",t(a)),g=c.selection.select("svg").insert("rect","g#arcs").attr("id","arc-events").attr("x",b.margin.left).attr("y",b.margin.top).attr("width",e()).attr("height",f()+2).style("opacity",0).call(d)}var g,a={},p=(function(){var a=Math.PI/180;return function(b){return b*a}}(),function(){var a=180/Math.PI;return function(b){return b*a}}(),function(a){var b=a;return a>Math.PI?(b=a-1.5*Math.PI,b=a-1.5*Math.PI):(b=a-.5*Math.PI,b=a-.5*Math.PI),-b});M.modes.angular={install:v,uninstall:function(){c.selection.select("svg").select("g#arcs").remove(),c.selection.select("svg").select("rect#arc-events").remove(),c.on("axesreorder.arcs",void 0),delete c.brushReset,g=void 0},selected:r,brushState:function(){return a}}}(),c.interactive=function(){return g.interactive=!0,this},c.xscale=h,c.ctx=n,c.canvas=o,c.g=function(){return m},c.resize=function(){return c.selection.select("svg").attr("width",b.width).attr("height",b.height),c.svg.attr("transform","translate("+b.margin.left+","+b.margin.top+")"),g.brushable&&c.brushReset(),c.autoscale(),m&&c.createAxes(),g.brushable&&c.brushable(),g.reorderable&&c.reorderable(),d.resize.call(this,{width:b.width,height:b.height,margin:b.margin}),this},c.highlight=function(a){return 0===arguments.length?b.highlighted:(b.highlighted=a,c.clear("highlight"),d3.selectAll([o.foreground,o.brushed]).classed("faded",!0),a.forEach(I),d.highlight.call(this,a),this)},c.unhighlight=function(){return b.highlighted=[],c.clear("highlight"),d3.selectAll([o.foreground,o.brushed]).classed("faded",!1),this},c.intersection=function(a,b,c,d){return{x:((a.x*b.y-a.y*b.x)*(c.x-d.x)-(a.x-b.x)*(c.x*d.y-c.y*d.x))/((a.x-b.x)*(c.y-d.y)-(a.y-b.y)*(c.x-d.x)),y:((a.x*b.y-a.y*b.x)*(c.y-d.y)-(a.y-b.y)*(c.x*d.y-c.y*d.x))/((a.x-b.x)*(c.y-d.y)-(a.y-b.y)*(c.x-d.x))}},c.mergeParcoords=function(a){var b=window.devicePixelRatio||1,d=document.createElement("canvas");d.width=c.canvas.foreground.clientWidth*b,d.height=(c.canvas.foreground.clientHeight+30)*b,d.style.width=d.width/b+"px",d.style.height=d.height/b+"px";var e=d.getContext("2d");e.fillStyle="#ffffff",e.fillRect(0,0,d.width,d.height);for(var f in c.canvas)e.drawImage(c.canvas[f],0,24*b,d.width,d.height-30*b);var h=(window.URL||window.webkitURL||window,new XMLSerializer),i=h.serializeToString(c.selection.select("svg")[0][0]),j="data:image/svg+xml;base64,"+window.btoa(i),k=new Image;k.onload=function(){e.drawImage(k,0,0,k.width*b,k.height*b),"function"==typeof a&&a(d)},k.src=j},c.version="0.7.0",c.toString=function(){return"Parallel Coordinates: "+d3.keys(b.dimensions).length+" dimensions ("+d3.keys(b.data[0]).length+" total) , "+b.data.length+" rows"},c},d3.renderQueue=function(a){var b=[],c=10,d=function(){},e=0,f=function(a){a&&f.data(a),f.invalidate(),d(),f.render()};return f.render=function(){function g(){if(!d)return!0;if(e>b.length)return!0;for(var f=Math.min(e+c,b.length),g=e;g<f;g++)a(b[g],g);e+=c}e=0;var d=!0;f.invalidate=function(){d=!1},d3.timer(g)},f.data=function(a){return f.invalidate(),b=a.slice(0),f},f.rate=function(a){return arguments.length?(c=a,f):c},f.remaining=function(){return b.length-e},f.clear=function(a){return arguments.length?(d=a,f):(d(),f)},f.invalidate=function(){},f};